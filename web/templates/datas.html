{% extends 'app.html' %}

{% block body %}
{% load humanize %}
 <!-- ============================================================== -->
            <!-- Start right Content here -->
            <!-- ============================================================== -->
            <div class="main-content">

                <div class="page-content">
                    <div class="container-fluid">

                        <!-- start page title -->
                        <div class="row">
                            <div class="col-12">
                                <div class="page-title-box d-flex align-items-center justify-content-between">
                                    <h4 class="mb-0 font-size-18">Purchase Data Subscription</h4>

                                    <div class="page-title-right">
                                        <ol class="breadcrumb m-0">
                                            <li class="breadcrumb-item active"><a href="{% url 'index' %}">Home</a></li>
                                            <li class="breadcrumb-item active"><a href="{% url 'service' %}">Services</a></li>
                                            <li class="breadcrumb-item active">Data Subscription</li>
                                        </ol>
                                    </div>

                                </div>
                            </div>
                        </div>
                        <!-- end page title -->

                        <div class="row">
                            <div class="container w-50 h-100">
                                <div class="row h-100 justify-content-center align-items-center">
                                  <form class="col-12" id="data">
                                    <div id="output" class="text-center font-weight-600 uppercase hide alert"></div>
                                    <div class="form-group">
                                        <label for="network">Select Network </label>
                                        <select id="network" onchange="getDataPlan()" class="form-control">
                                            <option selected>Choose Network</option>
                                            <option value="1">MTN NG</option>
                                            <option value="5">MTN NG (SME)</option>
                                            <option value="2">GLO NG</option>
                                            <option value="3">9mobile</option>
                                            <option value="4">AIRTEL NG</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label for="mobile">Mobile Number </label>
                                        <input type="text" pattern = "^[0]\d{10}$" maxlength="11" class="form-control" id="mobile" placeholder="090xxxxxxxx" required>
                                    </div>
                                    <div class="form-group">
                                        <label for="dataPlan">Select Data Plan </label>
                                        <select id="dataPlan" class="form-control" required>
                                            <option disabled selected>Choose Data Plan</option>
                                        </select>
                                    </div>
                                    <div class="container justify-content-center align-items-center">
                                        <button type="submit" class="btn btn-primary waves-effect waves-light w-100">Buy Now</button>
                                    </div>
                                  </form>   
                                </div>
                              </div>                              
                        </div>
                    </div>
                    <!-- container-fluid -->
                </div>
                <!-- End Page-content -->
	{% include 'footer.html' %}

    <script src="/static/libs/jquery/jquery.min.js"></script>
    <script>
        var mtn = [
            {
                "dataID": "153",
                "dataName": "500MB = ₦170 for 1 month",
                "dataAmount": "170"
            },
            {
                "dataID": "154",
                "dataName": "1GB = ₦310 for 1 month",
                "dataAmount": "310"
            },
            {
                "dataID": "155",
                "dataName": "2GB = ₦620 for 1 month",
                "dataAmount": "620"
            },
            {
                "dataID": "156",
                "dataName": "3GB = ₦930 for 1 month",
                "dataAmount": "930"
            },
            {
                "dataID": "158",
                "dataName": "5GB = ₦1550 for 1 month",
                "dataAmount": "1550"
            },
            {
                "dataID": "163",
                "dataName": "10GB = ₦3100 for 1 month",
                "dataAmount": "3100"
            },
            {
                "dataID": "165",
                "dataName": "15GB = ₦4650 for 1 month",
                "dataAmount": "4650"
            },
            {
                "dataID": "166",
                "dataName": "20GB = ₦6200 for 1 month",
                "dataAmount": "6200"
            },
            {
                "dataID": "164",
                "dataName": "40GB = ₦12400 for 1 month",
                "dataAmount": "12400"
            },

        ];
        var glo = [
            {
                "dataID": "69",
                "dataName": "1GB = ₦460 for 1 month",
                "dataAmount": "460"
            },
            {
                "dataID": "26",
                "dataName": "2.3GB = ₦910 for 1 month",
                "dataAmount": "910"
            },
            {
                "dataID": "32",
                "dataName": "3.75GB = ₦1360 for 1 month",
                "dataAmount": "1360"
            },
            {
                "dataID": "27",
                "dataName": "5.25GB = ₦1810 for 1 month",
                "dataAmount": "1810"
            },
            {
                "dataID": "28",
                "dataName": "7GB = ₦2260 for 1 month",
                "dataAmount": "2260"
            },
            {
                "dataID": "29",
                "dataName": "9GB = ₦2710 for 1 month",
                "dataAmount": "2710"
            },

        ];
        var airtel = [
            {
                "dataID": "40",
                "dataName": "750MB = ₦490 for 1 month",
                "dataAmount": "490"
            },
            {
                "dataID": "18",
                "dataName": "1.5GB = ₦950 for 1 month",
                "dataAmount": "950"
            },
            {
                "dataID": "46",
                "dataName": "2GB = ₦1165 for 1 month",
                "dataAmount": "1165"
            },
            {
                "dataID": "45",
                "dataName": "3GB = ₦1460 for 1 month",
                "dataAmount": "1460"
            },
            {
                "dataID": "19",
                "dataName": "4.5GB = ₦1820 for 1 month",
                "dataAmount": "1820"
            },
            {
                "dataID": "23",
                "dataName": "6.0GB = ₦2410 for 1 month",
                "dataAmount": "2410"
            },
            {
                "dataID": "24",
                "dataName": "11GB = ₦3850 for 1 month",
                "dataAmount": "3850"
            },
            {
                "dataID": "75",
                "dataName": "40GB = ₦9610 for 1 month",
                "dataAmount": "9610"
            },
            {
                "dataID": "76",
                "dataName": "75GB = ₦14410 for 1 month",
                "dataAmount": "14410"
            },
            {
                "dataID": "77",
                "dataName": "110GB = ₦19210 for 1 month",
                "dataAmount": "19210"
            },

        ];
        var etisalat = [
            {
                "dataID": "53",
                "dataName": "500MB = ₦490 for 1 month",
                "dataAmount": "490"
            },
            {
                "dataID": "13",
                "dataName": "1.5GB = ₦970 for 1 month",
                "dataAmount": "970"
            },
            {
                "dataID": "14",
                "dataName": "2GB = ₦1162 for 1 month",
                "dataAmount": "1162"
            },
            {
                "dataID": "15",
                "dataName": "3GB = ₦1450 for 1 month",
                "dataAmount": "1450"
            },
            {
                "dataID": "71",
                "dataName": "4.5GB = ₦1930 for 1 month",
                "dataAmount": "1930"
            },
            {
                "dataID": "72",
                "dataName": "11GB = ₦3850 for 1 month",
                "dataAmount": "3850"
            },
            {
                "dataID": "74",
                "dataName": "15GB = ₦4810 for 1 month",
                "dataAmount": "4810"
            },
            {
                "dataID": "73",
                "dataName": "40GB = ₦9610 for 1 month",
                "dataAmount": "9610"
            },

        ];
        var mtnsme = [
            {
                "dataID": "148",
                "dataName": "SME 500MB = ₦170 for 1 month",
                "dataAmount": "170"
            },
            {
                "dataID": "149",
                "dataName": "SME 1GB = ₦310 for 1 month",
                "dataAmount": "310"
            },
            {
                "dataID": "150",
                "dataName": "SME 2GB = ₦620 for 1 month",
                "dataAmount": "620"
            },
            {
                "dataID": "151",
                "dataName": "SME 3GB = ₦930 for 1 month",
                "dataAmount": "930"
            },
            {
                "dataID": "152",
                "dataName": "SME 5GB = ₦1550 for 1 month",
                "dataAmount": "1550"
            },

        ];
        function getDataPlan() {
            if (document.getElementById("network").value == "1"){
                var ele = document.getElementById('dataPlan');
                ele.options.length = 0;
                for (var i = 0; i < mtn.length; i++) {
                    // POPULATE SELECT ELEMENT WITH JSON.
                    ele.innerHTML = ele.innerHTML +
                        '<option value="' + mtn[i]['dataID'] + '" code="' + mtn[i]['dataAmount'] + '">' + mtn[i]['dataName'] + '</option>';
                }
            }
            else if (document.getElementById("network").value == "2"){
                var ele = document.getElementById('dataPlan');
                ele.options.length = 0;
                for (var i = 0; i < glo.length; i++) {
                    // POPULATE SELECT ELEMENT WITH JSON.
                    ele.innerHTML = ele.innerHTML +
                        '<option value="' + glo[i]['dataID'] + '" code="' + glo[i]['dataAmount'] + '">' + glo[i]['dataName'] + '</option>';
                }
            }
            else if (document.getElementById("network").value == "4"){
                var ele = document.getElementById('dataPlan');
                ele.options.length = 0;
                for (var i = 0; i < airtel.length; i++) {
                    // POPULATE SELECT ELEMENT WITH JSON.
                    ele.innerHTML = ele.innerHTML +
                        '<option value="' + airtel[i]['dataID'] + '" code="' + airtel[i]['dataAmount'] + '">' + airtel[i]['dataName'] + '</option>';
                }
            }
            else if (document.getElementById("network").value == "3"){
                var ele = document.getElementById('dataPlan');
                ele.options.length = 0;
                for (var i = 0; i < etisalat.length; i++) {
                    // POPULATE SELECT ELEMENT WITH JSON.
                    ele.innerHTML = ele.innerHTML +
                        '<option value="' + etisalat[i]['dataID'] + '" code="' + etisalat[i]['dataAmount'] + '">' + etisalat[i]['dataName'] + '</option>';
                }
            }
            else if (document.getElementById("network").value == "5"){
                var ele = document.getElementById('dataPlan');
                ele.options.length = 0;
                for (var i = 0; i < mtnsme.length; i++) {
                    // POPULATE SELECT ELEMENT WITH JSON.
                    ele.innerHTML = ele.innerHTML +
                        '<option value="' + mtnsme[i]['dataID'] + '" code="' + mtnsme[i]['dataAmount'] + '">' + mtnsme[i]['dataName'] + '</option>';
                }
            }
            else{
                var ele = document.getElementById('dataPlan');
                ele.options.length = 0;
                ele.innerHTML = ele.innerHTML +
                '<option value="">Select Network First</option>';
            }        
        }
        $('#data').on('submit', function(e){
            e.preventDefault();

            $.ajax({
                type : "POST",
                url: "{% url 'data_purchase' %}", /* django ajax posting url  */
                data: {
                    network : $('#network').val(),
                    mobile : $('#mobile').val(),
                    data_plan : $('#dataPlan').val(),
                    amount : $('#dataPlan').find(':selected').attr('code'),
                    csrfmiddlewaretoken: '{{ csrf_token }}',
                    dataType: "json",

                },
                beforeSend(){
                    // console.log(new FormData());
                },
                
                success: function(data){
                    if (data.error){
                        $('#data').find('.alert').removeClass('alert-success');
                        $('#data').find('.alert').removeClass('none');
                        $('#data').find('.alert').addClass('alert-warning');
                        $('#output').html(data.error) /* response message */
                    }
                    else{
                        $('#data').find('.alert').removeClass('alert-warning');
                        $('#data').find('.alert').removeClass('none');
                        $('#data').find('.alert').addClass('alert-success');
                        $('#output').html(data.success) /* response message */
                        // window.setTimeout(function(){
                        //     $('#data').find('input[type=text], textarea').val('');
                        // }, 700);
                        // setTimeout(redirect, 2000);
                        // function redirect(){
                        // window.location.href = "{% url 'verify_account' %}";
                        // }
                    }
                    
                },

                failure: function() {
            //       console.log(typeof(data.msg));
                    // $('.alert').html(data.msg+"hello")
                    
                }


            });
        });
    </script>
</div>

{% endblock %}
